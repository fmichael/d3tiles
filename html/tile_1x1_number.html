<div class='front'>
    <div class='setting_span'>
        <button class='setting_btn fill_btn'>Y</button>
        <span class='setting_btn title_area'><span class='tile_title'></span></span>
        <button class='setting_btn swap_btn pull-right'>X</button>
    </div>
    <div class='contents'></div>
</div>
<div class='back'>
    <div class='setting_span'>
        <button class='swap_btn save_btn first'>Save</button>
    </div>
    <div class='contents'>
        <div class='settings'>
            <input setFilt='label'type='text' value='Enter Label'></input><br />
            <select setFilt='type'>
                <!--<option value='percent'>Percent</option> SPECIAL CASE-->
                <option value='max'>Max</option>
                <option value='min'>Min</option>
                <option value='sum'>Sum</option>
                <option value='count'>Count</option>
                <option value='average'>Average</option>
            </select>
        </div>
        <div class='filter'>
            Min: <input setFilt='min' class='min' type='input' /><br />
            Max: <input setFilt='max' class='max' type='input' /><br />
        </div>
    </div>
</div>

<div class="tile_1x1_number_modal modal floatLeftSlide">
    <input type='hidden' value='new_1x1_number_tile' />
    <span class="closeModalButton">x</span>
    <span class="title">Create a new 1x1 Number Tile</span>
    <div class="form">
        <span class='title'>Title: <input type='text' required autofocus></input></span>
    </div>
    <div class="footer">
        <button class="cancelButton">Cancel</button>
        <button class="confirmButton">Confirm</button>
    </div>
    <script> /* Validation Code, Confirmation Code, etc */
        $('.confirmButton').on('click', function() {
            if($('.form > .title > input').val() == '') {
                $('.form > .title > input').addClass('error');
                return;
            }
            else
                $('.form > .title > input').removeClass('error');

            var filters = {};
            var settings = {};

            var groupid = viewable.pageList[viewable.activePage].addGroup('group_'+viewable.activePage);
            viewable.pageList[viewable.activePage].groupList[groupid].addData(makeData('number'));
            var tileid = viewable.pageList[viewable.activePage].groupList[groupid].addTile('tile_', 1, 1, 'number', $('.form > .title > input').val(), settings, filters);
            viewable.closeModal('floatRightSlide');
        });
    </script>
</div>

<script class='saving_function'>
    function tile_1x1_number_save() {
        var thee = this;

        if(this.type == 'chart' || this.type == 'table' || this.type == 'number') {
            $(this).closest('.back').find('.contents').children().each(function() {
                var which = 'settings';
                if ($(this).hasClass('settings'))
                    which = 'settings';
                else if ($(this).hasClass('filter'))
                    which = 'filters';

                $(this).children().each(function() {
                    var value = false;
                    var found = false;
                    //grab each setting
                    if ($(this).context.localName == 'input') {
                        switch($(this).attr('type')) {
                            case 'checkbox':
                                if($(this).is(":checked"))
                                    value = true;
                                else
                                    value = false;
                            break;
                            case 'radio':
                                if($(this).is(":checked"))
                                    value = true;
                                else
                                    value = false;
                            break;
                            case 'text':
                            case 'number':
                            case 'range':
                            case 'input':
                                if($(this).val() !== '')
                                    value = $(this).val();
                            break;
                        }
                        found = true;
                    }
                    else if ($(this).context.localName == 'textarea') {
                        if($(this).val() !== '') {
                            value = $(this).val();
                            found = true;
                        }
                    }
                    else if ($(this).context.localName == 'select') {
                        if($(this).val() !== '') {
                            value = $(this).val();
                            found = true;
                        }
                    }
                    if (found) {
                        if (which == 'settings')
                            thee.settings[$(this).attr('setFilt')] = value;
                        else
                            thee.filters[$(this).attr('setFilt')] = value;
                    }
                });
            });
            //no need to re-draw since redrawn once flipped back over
        }
    }
</script>

<script class='drawing_function'>
    function tile_1x1_number_draw() {
        var num = 0;
        var str = (this.settings.label == undefined) ? '' : this.settings.label;
        var type = (this.settings.type == undefined) ? 'count' : this.settings.type;
        if(typeof this.parent.data == 'number') { //a single data value was returned
            num = this.parent.data;
        }
        else {
            switch(type) {
                case 'count':
                    num = this.parent.data.length;
                    break;
                case 'sum':
                    for(var x in this.parent.data)
                        num += this.parent.data[x];
                    break;
                case 'min':
                    num = this.parent.data[0];
                    for(var x in this.parent.data)
                        if(num > this.parent.data[x])
                            num = this.parent.data[x];
                    break;
                case 'max':
                    num = this.parent.data[0];
                    for(var x in this.parent.data)
                        if(num < this.parent.data[x])
                            num = this.parent.data[x];
                    break;
                case 'average':
                    var ttl = this.parent.data.length;
                    for(var x in this.parent.data)
                        num += this.parent.data[x];
                    num = parseFloat((num / ttl).toFixed(2));
            }
        }
        //output to boxy box
        $('#drawable_'+this.id).empty();
        this.interactiveObject = '<span class="number">'+num+'</span><span class="label">'+str+'</span';
        $('#drawable_'+this.id).append(this.interactiveObject);
    }
</script>